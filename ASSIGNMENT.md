# Rapyd Sentinel Тестовое Задание

## Предыстория
Вы присоединяетесь к команде, работающей над воображаемым продуктом под названием Rapyd Sentinel, нашей флагманской платформой разведывательной информации об угрозах.

Для поддержки лучшей масштабируемости, соответствия требованиям и автономии команды, архитектура Sentinel недавно была разделена на два изолированных домена:
1. **Gateway Layer (Публичный)** – размещает интернет-ориентированные API и прокси
2. **Backend Layer (Приватный)** – запускает внутреннюю обработку и чувствительные сервисы

Эти две среды:
- Работают в отдельных AWS VPC
- Каждая размещает свой собственный Kubernetes кластер
- Должны общаться приватно и безопасно через сети

Вам поручено построить среду proof-of-concept, которая отражает эту архитектуру — используя Terraform, EKS и GitHub Actions CI/CD и container registry — и демонстрирует готовность к продакшену, модульность и лучшие практики безопасности.

---

## Цели
Вы будете:
- Использовать Terraform для построения двух изолированных VPC
- Деплоить два EKS кластера (по одному на VPC)
- Настраивать безопасную приватную сеть между ними
- Деплоить базовое приложение в backend и прокси в gateway
- Связывать все с CI/CD пайплайном
- Документировать ваш дизайн, решения по безопасности и компромиссы

---

## Требования
### Инфраструктура (Terraform)
- Создать два AWS VPC:
  - **vpc-gateway**: для прокси и публично-ориентированных сервисов
  - **vpc-backend**: для внутренних backend сервисов
- Каждый VPC должен включать:
  - Два приватных subnet в разных Availability Zones
  - NAT Gateways (для исходящего трафика при необходимости)
- Нет публичных EC2 или неограниченного доступа
- Создать VPC Peering (или опционально Transit Gateway) между VPC
- Настроить правильные route tables и security groups для разрешения меж-VPC приватной связи
- Деплоить один Amazon EKS кластер на VPC:
  - **eks-gateway** в vpc-gateway
  - **eks-backend** в vpc-backend
- Использовать Terraform модули для переиспользуемой, чистой структуры

### Рабочие Нагрузки Приложений (Kubernetes)
- В **eks-backend**:
  - Деплоить простой внутренний backend сервис (например, базовый веб-сервер, который отвечает "Hello from backend")
  - Не экспонировать его в интернет
- В **eks-gateway**:
  - Деплоить прокси приложение (например, NGINX reverse proxy или простой Node.js forwarder)
  - Прокси экспонирует публичный LoadBalancer
  - Весь трафик к прокси перенаправляется к backend сервису через VPC связь
- Настроить DNS resolution или жестко заданные IP по необходимости
- Валидировать, что прокси успешно достигает backend
- Ограничить сетевой доступ к backend сервису используя Security Groups, разрешая только трафик от EKS узлов (или CIDR) в VPC прокси кластера.
- Опционально, применить Kubernetes NetworkPolicy для дальнейшего ограничения внутренней связи подов в backend кластере.

### CI/CD Пайплайн (GitHub Actions)
- Настроить GitHub Actions workflow для:
  - Валидации Terraform (terraform validate, tflint)
  - Plan и apply Terraform
  - Валидации Kubernetes манифестов (kubeval, kubectl apply --dry-run)
  - Деплоя прокси и backend сервисов
- Workflow должен запускаться по push
- **Опциональный Бонус:** Использовать GitHub OIDC federation для деплоя в AWS без долгосрочных credentials

### Документация (README.md)
Включить четкие инструкции и обоснования:
- Как клонировать и запустить проект
- Как настроена сеть между VPC и кластерами
- Как прокси общается с backend
- Объяснение NetworkPolicy и модели безопасности
- Структура CI/CD пайплайна
- Компромиссы из-за 3-дневного лимита
- **Опционально:** Заметки по оптимизации стоимости (например, использование NAT, типы инстансов, выбор load balancer)
- Что вы сделали бы дальше (например, TLS/mTLS, observability, GitOps, ingress controllers, service mesh, Vault, и т.д.)

---

## Критерии Оценки
Мы будем искать:
- Правильность и безопасность инфраструктуры (приватные subnets, нет публичных EC2, строгие SGs)
- Качество Terraform: модульность, читаемость, поддерживаемость
- Настройку Kubernetes и работающую меж-кластерную связь
- Автоматизацию CI/CD, линтинг и flow деплоя
- Ясность и безопасность сети (VPC peering, SGs, NetworkPolicy)
- Реалистичность в дизайн компромиссах и следующих шагах
- Полноту и ясность документации 